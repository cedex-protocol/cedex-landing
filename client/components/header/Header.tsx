"use client";

import Image from "next/image";
import { Container } from "../layout";
import NetworkSelector from "../network-selector/NetworkSelector";
import MobileMenu from "./MobileMenu";
import { truncateAddress } from "@/lib/wallet";
import { useWallet } from "../../contexts/WalletProvider";
import { useUI } from "../../contexts/UIProvider";
import { useState, useEffect } from "react";
import styles from "./Header.module.scss";

export default function Header() {
  const [mounted, setMounted] = useState(false);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const { isConnected, walletAddress, disconnectWallet } = useWallet();
  const { openWalletSidebar } = useUI();

  useEffect(() => {
    setMounted(true);
  }, []);

  const handleLogoClick = () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };


  return (
    <header className={`${styles.header} ${isMobileMenuOpen ? styles.headerMenuOpen : ''}`}>
      <Container>
        <div className={styles.nav}>
          <div className={styles.logo} onClick={handleLogoClick}>
            <svg
              className={styles.logoDesktop}
              width="156"
              height="40"
              viewBox="0 0 156 40"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.4221 30.3356C10.9034 30.3356 9.66804 29.1007 9.66804 27.5826V22.6846C9.66804 21.5732 8.76569 20.6712 7.65386 20.6712H2.7527C1.23402 20.6712 0 19.4363 0 17.9195V12.4175C0 10.8994 1.23536 9.6658 2.7527 9.6658H7.65386C8.76569 9.6658 9.66804 8.76379 9.66804 7.65238V2.54097C9.66804 1.13963 10.8081 3.05176e-05 12.2099 3.05176e-05H27.8037C29.2055 3.05176e-05 30.3455 1.13963 30.3455 2.54097V8.46446C30.3455 9.8658 29.2055 11.0054 27.8037 11.0054H13.0236C11.9118 11.0054 11.0095 11.9074 11.0095 13.0188V17.3141C11.0095 18.4255 11.9118 19.3275 13.0236 19.3275H27.5915C29.1102 19.3275 30.3455 20.5624 30.3455 22.0806V27.5826C30.3455 29.1007 29.1102 30.3356 27.5915 30.3356H12.4194H12.4221Z"
                fill="url(#paint0_linear_86_4)"
              />
              <path
                d="M35.2919 40C33.89 40 32.75 38.8604 32.75 37.4591V31.5356C32.75 30.1343 33.89 28.9947 35.2919 28.9947H40.4039C41.5157 28.9947 42.418 28.0926 42.418 26.9812V22.6859C42.418 21.5745 41.5157 20.6725 40.4039 20.6725H35.504C33.9854 20.6725 32.75 19.4376 32.75 17.9195V12.4175C32.75 10.8994 33.9854 9.66446 35.504 9.66446H41.0081C42.5268 9.66446 43.7622 10.8994 43.7622 12.4175V17.3155C43.7622 18.4269 44.6645 19.3289 45.7763 19.3289H50.6775C52.1962 19.3289 53.4302 20.5638 53.4302 22.0806V27.5826C53.4302 29.1007 52.1948 30.3343 50.6775 30.3343H45.7763C44.6645 30.3343 43.7622 31.2363 43.7622 32.3477V37.4577C43.7622 38.8591 42.6221 39.9987 41.2203 39.9987H35.2946L35.2919 40Z"
                fill="url(#paint1_linear_86_4)"
              />
              <path
                d="M142.857 14.5455L146.38 20.9886L149.959 14.5455H154.312L149.05 23.2727L154.403 32H150.073L146.38 25.7159L142.721 32H138.357L143.675 23.2727L138.494 14.5455H142.857Z"
                fill="white"
              />
              <path
                d="M129.907 32.3409C128.157 32.3409 126.646 31.9773 125.373 31.25C124.108 30.5152 123.134 29.4773 122.453 28.1364C121.771 26.7879 121.43 25.2008 121.43 23.375C121.43 21.5795 121.771 20.0038 122.453 18.6477C123.142 17.2841 124.104 16.2235 125.339 15.4659C126.574 14.7008 128.025 14.3182 129.691 14.3182C130.767 14.3182 131.782 14.4924 132.737 14.8409C133.699 15.1818 134.547 15.7121 135.282 16.4318C136.025 17.1515 136.608 18.0682 137.032 19.1818C137.456 20.2879 137.669 21.6061 137.669 23.1364V24.3977H123.362V21.625H133.725C133.718 20.8371 133.547 20.1364 133.214 19.5227C132.881 18.9015 132.415 18.4129 131.816 18.0568C131.225 17.7008 130.536 17.5227 129.748 17.5227C128.907 17.5227 128.169 17.7273 127.532 18.1364C126.896 18.5379 126.4 19.0682 126.044 19.7273C125.695 20.3788 125.517 21.0947 125.509 21.875V24.2955C125.509 25.3106 125.695 26.1818 126.066 26.9091C126.438 27.6288 126.956 28.1818 127.623 28.5682C128.29 28.947 129.07 29.1364 129.964 29.1364C130.563 29.1364 131.104 29.053 131.589 28.8864C132.074 28.7121 132.494 28.4583 132.85 28.125C133.206 27.7917 133.475 27.3788 133.657 26.8864L137.498 27.3182C137.256 28.3333 136.794 29.2197 136.112 29.9773C135.438 30.7273 134.574 31.3106 133.521 31.7273C132.468 32.1364 131.263 32.3409 129.907 32.3409Z"
                fill="white"
              />
              <path
                d="M109.781 32.3068C108.41 32.3068 107.182 31.9545 106.099 31.25C105.016 30.5455 104.16 29.5227 103.531 28.1818C102.902 26.8409 102.588 25.2121 102.588 23.2955C102.588 21.3561 102.906 19.7197 103.542 18.3864C104.186 17.0455 105.054 16.0341 106.145 15.3523C107.235 14.6629 108.451 14.3182 109.792 14.3182C110.815 14.3182 111.656 14.4924 112.315 14.8409C112.974 15.1818 113.497 15.5947 113.883 16.0795C114.27 16.5568 114.569 17.0076 114.781 17.4318H114.951V8.72727H119.076V32H115.031V29.25H114.781C114.569 29.6742 114.262 30.125 113.86 30.6023C113.459 31.072 112.929 31.4735 112.27 31.8068C111.61 32.1402 110.781 32.3068 109.781 32.3068ZM110.929 28.9318C111.8 28.9318 112.542 28.697 113.156 28.2273C113.77 27.75 114.235 27.0871 114.554 26.2386C114.872 25.3902 115.031 24.4015 115.031 23.2727C115.031 22.1439 114.872 21.1629 114.554 20.3295C114.243 19.4962 113.781 18.8485 113.167 18.3864C112.561 17.9242 111.815 17.6932 110.929 17.6932C110.012 17.6932 109.247 17.9318 108.633 18.4091C108.02 18.8864 107.557 19.5455 107.247 20.3864C106.936 21.2273 106.781 22.1894 106.781 23.2727C106.781 24.3636 106.936 25.3371 107.247 26.1932C107.565 27.0417 108.031 27.7121 108.645 28.2045C109.266 28.6894 110.027 28.9318 110.929 28.9318Z"
                fill="white"
              />
              <path
                d="M93.3421 32.3409C91.5921 32.3409 90.0808 31.9773 88.8081 31.25C87.5429 30.5152 86.5694 29.4773 85.8876 28.1364C85.2058 26.7879 84.8649 25.2008 84.8649 23.375C84.8649 21.5795 85.2058 20.0038 85.8876 18.6477C86.577 17.2841 87.5391 16.2235 88.774 15.4659C90.0088 14.7008 91.4596 14.3182 93.1262 14.3182C94.202 14.3182 95.2171 14.4924 96.1717 14.8409C97.1338 15.1818 97.9823 15.7121 98.7171 16.4318C99.4596 17.1515 100.043 18.0682 100.467 19.1818C100.891 20.2879 101.104 21.6061 101.104 23.1364V24.3977H86.7967V21.625H97.1603C97.1527 20.8371 96.9823 20.1364 96.649 19.5227C96.3156 18.9015 95.8497 18.4129 95.2512 18.0568C94.6603 17.7008 93.9709 17.5227 93.1831 17.5227C92.3421 17.5227 91.6035 17.7273 90.9671 18.1364C90.3308 18.5379 89.8346 19.0682 89.4785 19.7273C89.13 20.3788 88.952 21.0947 88.9444 21.875V24.2955C88.9444 25.3106 89.13 26.1818 89.5012 26.9091C89.8724 27.6288 90.3914 28.1818 91.0581 28.5682C91.7247 28.947 92.505 29.1364 93.399 29.1364C93.9974 29.1364 94.5391 29.053 95.024 28.8864C95.5088 28.7121 95.9293 28.4583 96.2853 28.125C96.6414 27.7917 96.9103 27.3788 97.0921 26.8864L100.933 27.3182C100.691 28.3333 100.229 29.2197 99.5467 29.9773C98.8724 30.7273 98.0088 31.3106 96.9558 31.7273C95.9027 32.1364 94.6982 32.3409 93.3421 32.3409Z"
                fill="white"
              />
              <path
                d="M83.216 16.5795H78.966C78.8447 15.8826 78.6213 15.2651 78.2955 14.7273C77.9697 14.1818 77.5644 13.7197 77.0796 13.3409C76.5947 12.9621 76.0417 12.678 75.4205 12.4886C74.8069 12.2917 74.144 12.1932 73.4319 12.1932C72.1667 12.1932 71.0455 12.5114 70.0682 13.1477C69.091 13.7765 68.3258 14.7008 67.7728 15.9205C67.2197 17.1326 66.9432 18.6136 66.9432 20.3636C66.9432 22.1439 67.2197 23.6439 67.7728 24.8636C68.3334 26.0758 69.0985 26.9924 70.0682 27.6136C71.0455 28.2273 72.1629 28.5341 73.4205 28.5341C74.1175 28.5341 74.769 28.4432 75.375 28.2614C75.9887 28.072 76.5379 27.7955 77.0228 27.4318C77.5152 27.0682 77.9281 26.6212 78.2614 26.0909C78.6023 25.5606 78.8372 24.9545 78.966 24.2727L83.216 24.2955C83.0569 25.4015 82.7122 26.4394 82.1819 27.4091C81.6591 28.3788 80.9735 29.2348 80.125 29.9773C79.2766 30.7121 78.2841 31.2879 77.1478 31.7045C76.0114 32.1136 74.75 32.3182 73.3637 32.3182C71.3182 32.3182 69.4925 31.8447 67.8864 30.8977C66.2803 29.9508 65.0152 28.5833 64.091 26.7955C63.1667 25.0076 62.7046 22.8636 62.7046 20.3636C62.7046 17.8561 63.1705 15.7121 64.1023 13.9318C65.0341 12.1439 66.3031 10.7765 67.9091 9.82954C69.5152 8.88257 71.3334 8.40909 73.3637 8.40909C74.6591 8.40909 75.8637 8.59091 76.9773 8.95454C78.091 9.31818 79.0834 9.85227 79.9546 10.5568C80.8258 11.2538 81.5417 12.1098 82.1023 13.125C82.6705 14.1326 83.0417 15.2841 83.216 16.5795Z"
                fill="white"
              />
              <defs>
                <linearGradient
                  id="paint0_linear_86_4"
                  x1="15.1728"
                  y1="3.05176e-05"
                  x2="15.1728"
                  y2="30.3356"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stopColor="#01FE91" />
                  <stop offset="1" stopColor="#01FFFF" />
                </linearGradient>
                <linearGradient
                  id="paint1_linear_86_4"
                  x1="43.0901"
                  y1="9.66446"
                  x2="43.0901"
                  y2="40"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stopColor="#01FE91" />
                  <stop offset="1" stopColor="#01FFFF" />
                </linearGradient>
              </defs>
            </svg>
            <Image
              src="/icons/logo_mobile.svg"
              alt="Cedex"
              width={40}
              height={40}
              className={styles.logoMobile}
            />
          </div>

          <div className={styles.mobileActions}>
            <NetworkSelector />
            {mounted && isConnected ? (
              <button
                onClick={() => openWalletSidebar()}
                className={styles.walletMobileButton}
                aria-label="Open wallet"
              >
                <Image
                  src="/icons/wallet_mobile.svg"
                  alt="Wallet"
                  width={24}
                  height={24}
                />
              </button>
            ) : (
              <button
                onClick={() => openWalletSidebar()}
                className={styles.walletMobileButton}
                aria-label="Connect wallet"
              >
                <Image
                  src="/icons/wallet_mobile.svg"
                  alt="Wallet"
                  width={24}
                  height={24}
                />
              </button>
            )}
            <MobileMenu onMenuToggle={setIsMobileMenuOpen} />
          </div>

          <div className={styles.rightSection}>
            <div className={styles.socialSection}>
              <a
                href={process.env.NEXT_PUBLIC_SOCIAL_X_URL}
                target="_blank"
                rel="noopener noreferrer"
                className={styles.socialLink}
              >
                <Image src="/icons/x.svg" alt="X" width={24} height={24} />
              </a>
              <a
                href={process.env.NEXT_PUBLIC_SOCIAL_TELEGRAM_URL}
                target="_blank"
                rel="noopener noreferrer"
                className={styles.socialLink}
              >
                <Image
                  src="/icons/telegram.svg"
                  alt="Telegram"
                  width={24}
                  height={24}
                />
              </a>
            </div>

            <NetworkSelector />

            {!mounted ? (
              <button className={styles.walletButton}>Connect Wallet</button>
            ) : !isConnected ? (
              <button
                onClick={() => openWalletSidebar()}
                className={styles.walletButton}
              >
                <Image
                  src="/icons/not_connected_wallet.svg"
                  alt="Wallet"
                  width={16}
                  height={16}
                  className={styles.walletButtonIcon}
                />
                Connect Wallet
              </button>
            ) : (
              <div className={styles.walletConnected}>
                <button
                  onClick={() => openWalletSidebar()}
                  className={styles.walletAddressButton}
                >
                  <Image
                    src="/icons/wallet.svg"
                    alt="Wallet"
                    width={24}
                    height={24}
                    className={styles.walletIcon}
                  />
                  <span className={styles.walletAddress}>
                    {truncateAddress(walletAddress)}
                  </span>
                </button>
                <button
                  onClick={disconnectWallet}
                  className={styles.disconnectButton}
                  aria-label="Disconnect wallet"
                >
                  <Image
                    src="/icons/logout.svg"
                    alt="Logout"
                    width={24}
                    height={24}
                  />
                </button>
              </div>
            )}
          </div>
        </div>
      </Container>
    </header>
  );
}
